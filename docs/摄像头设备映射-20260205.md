# 摄像头设备映射 - 2026-02-05 更新

## 当前配置

| 摄像头 | 序列号 | 深度通道 | RGB通道 | 备注 |
|--------|--------|----------|---------|------|
| top | 405622073811 | /dev/video16 | /dev/video20 | USB: 3-6 |
| wrist | 347622073355 | /dev/video4 | /dev/video8 | USB: 2-2.2 |
| right_realsense | 346522074669 | /dev/video10 | /dev/video14 | USB: 3-1.3 |

## 重要说明

### RealSense RGB 通道访问限制

**不能直接用 v4l2/ffplay 访问 RealSense 的 RGB 通道！**

RealSense 摄像头的 RGB 模块需要通过 RealSense SDK 初始化后才能使用。直接用 v4l2 工具（如 ffplay）访问会卡住。

**正确的访问方式**：
1. 使用 RealSense SDK (pyrealsense2)
2. 使用 realsense-viewer
3. 使用 DORA 的 camera_rgbd_realsense 组件（已配置）

**错误的访问方式**：
- ❌ `ffplay -f v4l2 /dev/video20` - 会卡住
- ❌ `v4l2-ctl --device=/dev/video20 --stream-mmap` - 会卡住
- ❌ OpenCV `cv2.VideoCapture(20)` - 会卡住

### DORA 配置

DORA 数据流已正确配置使用 RealSense SDK：

```yaml
- id: camera_top
  path: .../camera_rgbd_realsense/main.py
  env:
    DEVICE_SERIAL: "405622073811"  # 通过序列号访问
```

这样配置后，DORA 会使用 RealSense SDK 正确初始化和访问摄像头。

## 配置文件位置

### DORA 数据流配置
- 文件: `operating_platform/teleop_vr/dora_leader_follower_x5.yml`
- Top 相机: 第 21 行 `DEVICE_SERIAL: "405622073811"`
- Wrist 相机: 第 34 行 `DEVICE_SERIAL: "347622073355"`
- Right 相机: 第 47 行 `DEVICE_SERIAL: "346522074669"`

### Python 配置
- 文件: `operating_platform/robot/robots/configs.py`
- LeaderX5RobotConfig: 第 751-771 行

## 故障排查

### 问题：DORA 数据流中 top 相机无图像

**检查步骤**：

1. **确认摄像头被识别**
   ```bash
   rs-enumerate-devices | grep 405622073811
   ```

2. **测试 RealSense SDK 访问**
   ```bash
   realsense-viewer
   # 选择序列号 405622073811 的摄像头
   # 启动 RGB 流
   ```

3. **检查 DORA 日志**
   ```bash
   source ~/miniconda3/bin/activate dorobot
   dora logs camera_top
   ```

4. **检查 USB 带宽**
   - 3 个 RealSense 摄像头需要大量 USB 带宽
   - 建议分散到不同的 USB 控制器
   - 使用 USB 3.0 端口

### 问题：换 USB 插口后设备号变化

**现象**：
- 之前 top 相机在 /dev/video8
- 现在 top 相机在 /dev/video20

**影响**：
- ✅ DORA 配置不受影响（使用序列号）
- ✅ Python 配置不受影响（使用序列号）
- ❌ 如果有脚本硬编码 video 设备号，需要更新

**解决方案**：
- 始终使用序列号而不是设备号
- DORA 和 lerobot 配置已正确使用序列号

## 测试命令

### 测试 RealSense SDK 访问（正确方式）
```python
import pyrealsense2 as rs

pipeline = rs.pipeline()
config = rs.config()
config.enable_device('405622073811')  # top 相机
config.enable_stream(rs.stream.color, 640, 480, rs.format.bgr8, 30)

pipeline.start(config)
frames = pipeline.wait_for_frames()
color_frame = frames.get_color_frame()
print(f"获取到图像: {color_frame.get_width()}x{color_frame.get_height()}")
pipeline.stop()
```

### 测试 DORA 数据流
```bash
cd /home/dora/DoRobot-vr/operating_platform/teleop_vr
source ~/miniconda3/bin/activate dorobot
dora start dora_leader_follower_x5.yml

# 等待 10 秒
sleep 10

# 检查节点状态
dora list

# 查看 camera_top 日志
dora logs camera_top
```

## 更新历史

- 2026-02-05: Top 相机换 USB 插口，从 video8 变为 video20
- 2026-02-05: 确认 DORA 配置使用序列号，不受设备号变化影响
