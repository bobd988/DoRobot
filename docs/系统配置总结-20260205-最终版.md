# 系统配置总结 - 2026-02-05 最终版

## 📊 设备配置

### 摄像头配置

| 摄像头 | 序列号 | 型号 | USB 位置 | 深度通道 | RGB通道 | 状态 |
|--------|--------|------|---------|----------|---------|------|
| top | **406122070147** | D435I | usb4/4-6 | /dev/video4 | /dev/video8 | ✅ 正常 |
| wrist | 347622073355 | D435I | usb2/2-2.2 | /dev/video10 | /dev/video14 | ✅ 正常 |
| right_realsense | 346522074669 | D435 | usb3/3-1.4 | /dev/video16 | /dev/video20 | ✅ 正常 |

### 机械臂配置

| 设备 | 接口 | 端口 | 状态 |
|------|------|------|------|
| 主臂 (Feetech) | USB 串口 | /dev/ttyACM0 | ✅ 正常 |
| 从臂 (ARX-X5) | CAN | can0 | ✅ 正常 |

### USB 总线分布

| USB Bus | 控制器 | 连接设备 | 带宽状态 |
|---------|--------|---------|---------|
| Bus 001 | Intel 5781 | 空闲 | ✅ 充足 |
| Bus 002 | Intel 5782 | Wrist 相机 | ✅ 充足 |
| Bus 003 | Intel 7f6e | Right 相机 + 主臂串口 | ✅ 充足 |
| Bus 004 | Intel 7f6e | Top 相机 | ✅ 充足 |

## 🔄 配置变更记录

### 2026-02-05 更新

**变更内容**：Top 相机序列号更新

- **旧序列号**: 405622073811
- **新序列号**: 406122070147
- **原因**: 更换了不同的 RealSense D435I 摄像头

**更新的文件**：
1. `operating_platform/teleop_vr/dora_leader_follower_x5.yml` (第 21 行)
2. `operating_platform/robot/robots/configs.py` (第 754 行)

## ✅ 测试结果

### RealSense SDK 测试

```
[top]             序列号: 406122070147  →  ✓ 正常 (640x480)
[wrist]           序列号: 347622073355  →  ✓ 正常 (640x480)
[right_realsense] 序列号: 346522074669  →  ✓ 正常 (640x480)
```

### RGB 通道测试

```
/dev/video8  (top)             →  ✓ 可以打开
/dev/video14 (wrist)           →  ✓ 可以打开
/dev/video20 (right_realsense) →  ✓ 可以打开
```

### USB 带宽测试

- ✅ 所有摄像头可以同时工作
- ✅ 无带宽冲突
- ✅ 帧率稳定在 30fps

## 🚀 启动命令

### 数据录制

```bash
cd /home/dora/DoRobot-vr
bash scripts/run_so101.sh
```

### 检查设备状态

```bash
# 检查摄像头
rs-enumerate-devices | grep -E "(Serial Number|Name)"

# 检查主臂
ls -l /dev/ttyACM0

# 检查从臂
ip link show can0

# 检查 USB 分布
lsusb | grep -i realsense
```

## 📝 配置文件位置

### DORA 数据流配置
- **文件**: `operating_platform/teleop_vr/dora_leader_follower_x5.yml`
- **Top 相机**: 第 21 行 `DEVICE_SERIAL: "406122070147"`
- **Wrist 相机**: 第 34 行 `DEVICE_SERIAL: "347622073355"`
- **Right 相机**: 第 47 行 `DEVICE_SERIAL: "346522074669"`

### Python 配置
- **文件**: `operating_platform/robot/robots/configs.py`
- **LeaderX5RobotConfig**: 第 751-771 行
- **Top 相机**: 第 754 行 `serial_number="406122070147"`

## ⚠️ 重要提示

1. **序列号固定**: 摄像头序列号是硬件固定的，不会因为 USB 端口变化而改变
2. **USB 分布**: 当前配置已优化，每个 USB 控制器的带宽充足
3. **不要移动摄像头**: 当前 USB 连接已优化，除非必要，不要更换 USB 端口
4. **配置同步**: 如果更换摄像头，需要同时更新 DORA 和 Python 配置文件

## 🔧 故障排查

### 问题：摄像头无法检测

```bash
# 1. 检查 USB 连接
lsusb | grep -i realsense

# 2. 检查 RealSense SDK
rs-enumerate-devices

# 3. 重新插拔摄像头
# 拔出 → 等待 10 秒 → 重新插入 → 等待 10 秒
```

### 问题：DORA 数据流失败

```bash
# 1. 检查日志
source ~/miniconda3/bin/activate dorobot
dora logs camera_top
dora logs camera_wrist
dora logs camera_right_realsense

# 2. 重启 DORA
dora stop
bash scripts/run_so101.sh
```

### 问题：数据录制报错 KeyError: 'top'

**原因**: DORA 数据流中的 camera_top 节点没有正常工作

**解决**:
1. 检查 DORA 数据流状态: `dora list`
2. 查看 camera_top 日志: `dora logs camera_top`
3. 确认摄像头序列号匹配配置文件

## 📊 系统性能

- **摄像头帧率**: 30 fps (所有摄像头)
- **分辨率**: 640x480 (所有摄像头)
- **数据录制频率**: 30 Hz
- **主臂采样频率**: 20 Hz
- **从臂控制频率**: 20 Hz

## ✅ 系统就绪

所有设备已正确配置并测试通过，系统可以正常进行数据录制。

---

**文档版本**: v2.0
**最后更新**: 2026-02-05 11:10
**更新内容**: Top 相机序列号更新为 406122070147
