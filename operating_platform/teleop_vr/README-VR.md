# VR 系统使用指南（只验证了，仿真环境下可以work）

## 网络架构

```
┌─────────────────────┐
│   Meta Quest VR     │
│   (WiFi 连接)       │
└──────────┬──────────┘
           │ WiFi
           │
    ┌──────┴──────┐
    │   路由器     │
    └──────┬──────┘
           │ WiFi/以太网
           │
┌──────────┴──────────┐
│   控制电脑           │
│   (运行 VR 系统)     │
└──────────┬──────────┘
           │ USB
           │
┌──────────┴──────────┐
│   SO101 机械臂       │
│   (/dev/ttyACM0)    │
└─────────────────────┘
```

## 详细连接步骤

### 1. 机器人端设置

**硬件连接：**
```
SO101 机械臂 ──USB线──> 控制电脑 ──WiFi/网线──> 路由器
```
确认头显和手柄电量充足

**软件配置：**
```bash
# 1. 确认机械臂连接
ls -l /dev/ttyACM0

# 2. 确认电脑 IP 地址
hostname -I
# 记下这个 IP 地址，例如：192.168.1.100

# 3. 启动 VR 系统
cd /home/demo/Public/DoRobot/operating_platform/teleop_vr
./start_vr.sh
```

### 2. VR 头显端设置

**网络连接：**
- 准备一个可以翻墙的WIFI。建议在Windows中使用喵子加速器
1. 戴上 Meta Quest 头显
2. 进入设置 → WiFi
3. 连接到**与电脑相同的 WiFi 网络**
4. 确认连接成功

**访问 VR 界面：**
1. 打开 Quest 浏览器（Oculus Browser 或 Meta Quest Browser）
2. 在地址栏输入：`https://<电脑IP>:8443`
   - 例如：`https://192.168.1.100:8443`
3. 接受自签名证书警告（点击"高级" → "继续访问"）
4. 看到 VR 界面后，点击右上角的 进入VR 图标
5. 进入 VR 模式，开始控制机械臂

**系统设计理念：**
```
VR 端（Meta Quest）
  └─ 只负责输入：捕获手柄的位置、旋转、按钮状态
  └─ 通过 WebSocket 发送数据到后端

后端（控制电脑）
  ├─ 接收 VR 数据
  ├─ 进行 IK 求解（逆运动学）
  ├─ 控制真实的物理机械臂
  └─ 在电脑上显示 PyBullet 仿真窗口（可选）
```

**机械臂模型的位置：**
- 机械臂的 3D 模型（STL 文件）存在于 `urdf/SO100/assets/` 目录
- 这些模型用于：
  - ✅ PyBullet 仿真（在控制电脑上显示）
  - ✅ IK 求解（计算关节角度）
  - ❌ 不在 VR 场景中显示

**如何观察机械臂运动：**
1. **直接观察真实机械臂**（推荐）- 通过 VR 的透视模式或摘下头显
2. **查看电脑上的仿真窗口** - PyBullet 会显示机械臂的虚拟模型
3. **控制器上的文本信息** - 显示当前的位置和旋转数据

**手柄控制方法：**
- **握把按钮（Grip）**：按住时启用控制，松开时停止（离合机制）
- **扳机键（Trigger）**：控制夹爪开合
- 按住握把按钮，同时移动手柄，机械臂会跟随运动

## VR 使用指南

### 进入 VR 场景后你会看到什么

#### 视觉内容
1. **深灰色背景** - 防止黑屏，提供基本的空间感
2. **左右手控制器**：
   - 每个控制器上有 **RGB 坐标轴**（红色=X轴，绿色=Y轴，蓝色=Z轴）
   - 控制器上方有**白色文本**显示：
     - `Pos: X Y Z` - 控制器的位置坐标（米）
     - `Rot: X Y Z` - 控制器的旋转角度（度）
     - `Z-Rot: XX.X°` - 当你按住握把时显示，表示绕 Z 轴的旋转

### 完整操作流程

```
1. 戴上 Meta Quest 头显
   ↓
2. 访问 https://<电脑IP>:8443
   ↓
3. 接受 SSL 证书警告
   ↓
4. 点击页面上的 VR 图标进入 VR 模式
   ↓
5. 看到深灰色背景和两个控制器
   ↓
6. 移动手柄，确认文本信息实时更新
   ↓
7. 按住左手握把按钮（Grip）
   ↓
8. 移动左手柄，观察真实机械臂跟随
   ↓
9. 按下扳机键（Trigger），夹爪闭合
   ↓
10. 松开握把按钮，停止控制
   ↓
11. 重新调整手柄位置，继续操作
```

### 详细操作步骤

#### 第一步：验证系统连接
1. **移动手柄** - 观察控制器上的文本是否实时更新
2. **检查 WebSocket 连接**：
   - 如果连接成功，浏览器控制台会显示：
     ```
     WebSocket connected to wss://<电脑IP>:8442
     ```
   - 如果连接失败，会显示错误信息

#### 第二步：测试手柄控制

**左手控制器操作：**

1. **按住左手握把按钮（Grip）**
   - 这是"离合"机制，按住时启用控制
   - 松开时停止控制，可以重新调整手柄位置
   - 按住时，文本会显示 `Z-Rot` 值

2. **移动左手柄**（握把按住时）
   - 前后左右上下移动
   - 旋转手柄
   - **真实的机械臂应该跟随你的手柄运动**

3. **按下扳机键（Trigger）**
   - 控制夹爪闭合
   - 松开扳机键，夹爪打开

**右手控制器：**
- 目前系统配置为单臂控制（左手）
- 右手控制器也会显示追踪信息，但可能不控制机械臂

### 预期行为

#### 正常工作时：
- ✅ 控制器文本实时更新
- ✅ 按住握把时，真实机械臂跟随手柄运动
- ✅ 扳机键控制夹爪开合
- ✅ 松开握把时，机械臂停止运动
